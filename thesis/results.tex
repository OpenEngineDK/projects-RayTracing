\chapter{Results}\label{chp:results}

\chapterquote{It’s hardware that makes a machine fast. It’s software
  that makes a fast machine slow.}{Craig Bruce}

% Tabels of nodes and triangled visited. Perhaps some statistics over
% wasted iterations by threads waiting for other threads in the warp
% to finish. The high triangle count pr leaf optimization may be
% related to this and makes using highly optimized splitting plane
% calculations in the lower nodes useless.


% Test scenes: Cornell, reflecting dragon2 and sponza

\begin{figure}
  \centering
  \subfloat[The Cornell Box - 36 Triangles.]{
    \includegraphics[width=0.3\textwidth]{cornellBox}
  }
  \subfloat[The Reflecting Stanford Dragon - 203k Triangles.]{
    \includegraphics[width=0.3\textwidth]{semiReflectingDragon}
  }
  \subfloat[Sponza - 279k Triangles.]{
    \includegraphics[width=0.3\textwidth]{sponza}
  }
  \caption[Test scenes.]{The 3 test scenes.}
  \label{fig:testScenes}
\end{figure}

% Evaluate ray tracers

% First establish which ray tracer works the best

\newcommand{\tabelMoeller}{
  \begin{tabular}{c}
    Moeller- \\ Trumbore
  \end{tabular}
}

\begin{figure}
  \centering
  \SetTabelTextSize
  \begin{tabular} {r | c | c | c || c || c || c ||}
    \tabelParam{c}{\textit{Ray} \\ \textit{Tracer:}} &
    \tabelParam{c}{\textit{Ray/triangle}\\\textit{intersection:}} &
    \tabelParam{c}{\textit{Packets:}} &
    \tabelParam{c||}{\textit{Leaf} \\ \textit{skipping:}} &
    \tabelScene{Cornell \\ Box \\ (3)} & 
    \tabelScene{Reflecting \\ Dragon \\ (49909)} & 
    \tabelScene{Sponza \\ (98779)}\\
      \hline
      \multirow{4}{*}{Exhaustive} & \multirow{2}{*}{\tabelMoeller} & No & N/A & 11.2ms & \worstResult{1118ms} & \worstResult{964ms} \\
      \cline{3-7}
      & & Yes & N/A & \worstResult{11.6ms} & 1114ms & \worstResult{964ms} \\
      \cline{2-7}
      & \multirow{2}{*}{Woop} & No & N/A & \bestResult{9.3ms} & \bestResult{898ms} & \bestResult{650ms}\\
      \cline{3-7}
      & & Yes & N/A & 9.7ms & 903ms & 651ms\\
      \hline
      \hline

  % KD-Restart
  \multirow{8}{*}{KD-Restart} & \multirow{4}{*}{\tabelMoeller} & \multirow{2}{*}{No} & No & 17.9ms & \worstResult{790ms} & \worstResult{592ms} \\
  \cline{4-7}
  & & & Yes & \worstResult{18.1ms} & 486ms & 287ms \\
  \cline{3-7}
  & & \multirow{2}{*}{Yes} & No & 17.2ms & 579ms & 424ms \\
  \cline{4-7}
  & & & Yes & 17.4ms & \bestResult{355ms} & \bestResult{196ms} \\
  \cline{2-7}
  & \multirow{4}{*}{Woop} & \multirow{2}{*}{No} & No & 15.5ms & 690ms & 549ms \\
  \cline{4-7}
  & & & Yes & 15.8ms & 500ms & 287ms \\
  \cline{3-7}
  & & \multirow{2}{*}{Yes} & No & \bestResult{14.6ms} & 495ms & 342ms \\
  \cline{4-7}
  & & & Yes & 14.8ms & \bestResult{355ms} & \bestResult{198ms} \\
  \hline
  \hline

  % Short-Stack
  \multirow{8}{*}{Short-Stack} & \multirow{4}{*}{\tabelMoeller} & \multirow{2}{*}{No} & No & 20.0ms & \worstResult{808ms} & \worstResult{595ms} \\
  \cline{4-7}
  & & & Yes & \worstResult{20.2ms} & 503ms & 266ms \\
  \cline{3-7}
  & & \multirow{2}{*}{Yes} & No & 19.5ms & 590ms & 421ms \\
  \cline{4-7}
  & & & Yes & 19.8ms & \bestResult{360ms} & \bestResult{167ms} \\
  \cline{2-7}
  & \multirow{4}{*}{Woop} & \multirow{2}{*}{No} & No & 18.5ms & 738ms & 560ms \\
  \cline{4-7}
  & & & Yes & 18.7ms & 522ms & 270ms \\
  \cline{3-7}
  & & \multirow{2}{*}{Yes} & No & \bestResult{17.8ms} & 523ms & 348ms \\
  \cline{4-7}
  & & & Yes & 18.1ms & 368ms & 171ms \\
  \hline
\end{tabular}
\caption[Stuff]{more stuff}
\label{fig:rayTracerEvaluation}
\end{figure}



% Upper tree creation parameters

% Not creating lower nodes (using None)

\begin{figure}
  \centering
  \SetTabelTextSize
  \begin{tabular} {c | c | c || c || c ||}
    % Titel bar: Association scheme | empty space maximization | threshold |
    % Cornell | dragon | sponza
    \multicolumn{1}{c}{\begin{tabular}{c}\textit{Association} \\ \textit{scheme:}\end{tabular}} &
    \multicolumn{1}{c}{\begin{tabular}{c}\textit{Empty Space} \\ \textit{Maximization:}\end{tabular}} &
    \begin{tabular}{c}\textit{Empty}\\\textit{Space} \\ \textit{Threshold:}\end{tabular} &
    \tabelScene{Reflecting \\ Dragon} &
    \tabelScene{Sponza}\\
    \hline % Titel end
    \multirow{4}{*}{Dividing} & No & N/A & \worstResult{146+385ms (38k)} & \worstResult{258-220ms (87k)}\\
    \cline{2-5}
    & \multirow{3}{*}{Yes} & 15\% & 150+376ms (56k) & 263-167ms (104k) \\
    \cline{3-5}
    & & 25\% & 150+355ms (50k) & 263-167ms (99k)\\
    \cline{3-5}
    & & 35\% & 150+357ms (45k) & 263-167ms (95k)\\
    \hline
    \multirow{4}{*}{Box Inclusion} & No & N/A & 116+397ms (41k) & 213-241ms (112k) \\
    \cline{2-5}
    & \multirow{3}{*}{Yes} & 15\% & 121+386ms (59k) & 219-182ms (130k) \\
    \cline{3-5}
    & & 25\% & 121+373ms (53k) & 219-182ms (125k)\\
    \cline{3-5}
    & & 35\% & \bestResult{121+366ms (48k)} & \bestResult{219-180ms (120k)}\\
    \hline
  \end{tabular}
  \caption[Upper tree creation results.]{Upper tree creation results. --What is
    seen and what parameters where used--}
  \label{fig:upperResults}
\end{figure}


% Lower node creation

\begin{figure}
  \centering
  \SetTabelTextSize
  \begin{tabular}{c |c | c || c || c ||}
    \tabelParam{c}{\textit{Bit Mask:}} &
    \tabelParam{c}{\textit{Splitting} \\ \textit{Scheme:}} &
    \tabelParam{c||}{$C_{N}:$} &
    \tabelScene{Reflecting \\ Dragon} &
    \tabelScene{Sponza}\\
    \hline % Titel end
    \multirow{7}{*}{32bit} & None & N/A & \bestResult{121/357ms (48.1k)} & \bestResult{219/179ms (120k)}\\
    \cline{2-5}
    & \multirow{3}{*}{SAH} & 24 & 273/358ms (48.2k) & 616/180ms (121k)\\
    \cline{3-5}
    & & 16 & 273/359ms (48.3k) & 648/180ms (129k)\\
    \cline{3-5}
    & & 8 & \worstResult{280/358ms (50k)} & \worstResult{775/181ms (167k)}\\
    \cline{2-5}
    & \multirow{3}{*}{SSAH} & 24 & 159/382ms (126k) & 305/201ms (287k)\\
    \cline{3-5}
    & & 16 & 162/393ms (143k) & 309/207ms (313k)\\
    \cline{3-5}
    & & 8 & 165/401ms (168k) & 318/227ms (394k)\\
    \hline \hline
    \multirow{7}{*}{64bit} & None & N/A & \bestResult{98/464ms (19k)} & \bestResult{160/193ms (38k)}\\
    \cline{2-5}
    & \multirow{3}{*}{SAH} & 40 & 1113/462ms (20k) & 2393/194ms (41k)\\
    \cline{3-5}
    & & 32 & 1113/463ms (20) & 2530/193ms (43k)\\
    \cline{3-5}
    & & 24 & \worstResult{1126/467ms (20)} & \worstResult{2816/190ms (48k)}\\
    \cline{2-5}
    & \multirow{3}{*}{SSAH} & 40 & 326/416ms (92k) & 609/200ms (162k)\\
    \cline{3-5}
    & & 32 & 328/423ms (102k) & 613/204ms (177k) \\
    \cline{3-5}
    & & 24 & 331/426ms (110k) & 616/206ms (191k)\\
    \hline
  \end{tabular}
  \caption[Lower tree creation results.]{Lower tree creation results. --What is
    seen and what parameters where used--}
  \label{fig:lowerResults}
\end{figure}

% Splitting Schemes:

% Profile the time it takes to create the different trees, especially
% the splitting kernels.

% Compare amount of nodes.

% Tree traversal time.

% Warp coherence: balance between traversal steps and intersections =
% high amount of nodes in the leafs ie even less important to spend
% alot of time on that last split.


