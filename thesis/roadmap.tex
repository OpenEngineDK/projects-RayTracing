\section*{Road Map}


\begin{itemize}
\item \color{green}Create the KD-tree from points on the GPU \checkmark
\item Visualize the KD-tree (as part of debugging), draw frame around
  splitting plane in color corrosponding to splitting axis. (\checkmark)
\item Extend KD-tree to work on triangles \checkmark
\item raytrace the triangle KD-tree \checkmark
\item Add a balanced tree lower node creator \checkmark
\item Reduce more than 1024 segments \checkmark
\item Add empty space splitting
  \begin{itemize}
    \item Extend CreateUpperChildren with the possibility to use indices \checkmark
    \item Copy aabb to lower nodes \checkmark
    \item In reduce, compare the existing aabb with the reduced. \checkmark
    \item Move the nodes by the amount of emptySplitNodes, create the
      empty split nodes in front of the nodes and link them with the
      previous nodes parents.\\ Remember to update segments (used when
      splitting triangles), node size and activeIndex. \checkmark
    \item \color{red}Make dynamic empty space threshold. Higher probability of
      splits at the top, than bottom.
    \item PROFIT
  \end{itemize}
\item Optimize GeometryList
  \begin{itemize}
  \item Removed OpenGL and use device arrays instead. Oh such clean
    geometry collection code. \checkmark
  \end{itemize}
\item Partition the screen into 8x4 ray blocks to improve ray
  traversel coalescenece. \checkmark
\item Use triangle-box intersection to remove ``impossible to hit''
  triangles from the lower nodes. Aabb might need to be propagated
  downwards in order to do this.
\item Create an optimized aabb intersection algorithm that
optimizes with respect to a triangle and 2 boxes. Doesn't work due to
the compiler dropping the ball when switches contain huge cases..
\item Use woop triangle intersection instead while raytracing (Make an
  enum that can switch). Place the offset in the fourth component of
  each vector, that way I only need to load 1 float4 pr tHit
  component. Less register usage! Yielded 20\% increase on dragon2 in
  cornell box.
\item Make colors float instead of char. Removes 4 divisions when
  coloring. (And apparently add a data fetching overhead, not worth
  it)
\item Add a bounding box check before raytracing leafs? Provides an
  early out option for long rays. Nice speedup. Won't work aswell with
  small leaf nodes? Inspired by empty space splitting.

\color{red}
\item Instead of moving nodes when doing an empty split, place them
  empty nodes after index + range and remember to skip them when
  creating children. (node size can probably be used for this,
  and the outermost while loop would work unaltered).
\item Instead of resizing aabbs, perhaps just use the original size
  and crop it with the propagated aabb. Then test if splitting and
  creating new aabbs even adds any speed or if indexing is faster.
\item Add triangle split. Triangle split can possibly gain
  some performance, by always doing the ``2 triangles'' side first.
\item Make indices in primMin and tHit a float\_to\_int gøjler. Saves
  an actual conversion (and like what, 2ms total, boy you're starting
  to go overboard here)
\end{itemize}

If time allows

\begin{itemize}
\item Perhaps storing normals in uchar will speedup normal fetching
  and more importantly save registers (it will!).
\item Speedup shadow rays and ambient occlusion. Mostly from simpler
  intersection testing and less register usage.\\ -- OR -- \\ Perhaps
  let the primary raytracer to it's job (coloring and refraction),
  then dump the individual colors and primitive indices into arrays
  (some MAX like 5?), let a different raytracer pickup these values
  and start tracing shadows. Combine everything in a last kernel for
  PROFIT.
\item Add Persistent Theads to SAH. Extend it with preemtively
  replacing dead threads every 4 or so cycle.
\item Add persistent threads to the ray tracer
\item Add an oscilating surface with nice refraction!!
\item Look into SAH approximations
\item Optimize segmented reduce. (low low priority)
\end{itemize}




\subsection*{Sangild}

Bank conflicts.

====

Occupancy

Primære og sekundære kilder? Both good. Just quote responsibly (page
number, section, something)

Slå register usage op på runtime? Can't be done. Hardcode the
bastards. And fix KernelConf1D when registers are used (something
about 512bit allocation, unless 2.0 architeture)
